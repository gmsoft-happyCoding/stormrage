# 各个功能设计

不仅要为 SVN 做适配，还有提前对 git 进行适配

开发测试 SVN 目录：`https://192.168.2.10:8080/svn/GmsoftPlatform/B持续交付与自动化/CICD开发测试目录`

## 1、版本分支功能设计

### 1-1、Fork

默认规则：默认从 Latest 版本分出，分两种模式：

1. 如果是老的 trunk/tags 分支管理模式则使用 tags 最后的版本作为 Base 进行 Fork
2. 如果是新的 master 分制管理模式，则使用 trunk 作为 Base 进行 Fork

```sh
stormrage fork <target branch name> [project path] [-base <base branch name>]
```

参数说明：

- project path：分版的项目根路径（远程路径或本地路径），如果是远程路径，将直接使用；如果是本地路径将使用当前工作空间信息确定远程路径，然后在远程路径上逐级回退寻找项目根路径（**① 根路径判定依据**），最后再依据“默认规则”确定原始分支实际路径，如果创建的分支已经存在，将抛出异常代码 [1001](#1001)
- target branch name：要创建的版本名称，如果当前项目采用 Master 模式管理分支，则所有的分支统一创建在 branch 下；如果采用老模式，则 trunk 分支创建在项目根路径下，其他分支创建在 branch 下
- base：创建分支时使用的原始分支，默认情况下，在 Master 模式下使用 Trunk 分支作为原始分支，老模式下使用 Tags 最后一个版本作为原始分支。如果有特殊需要，可以使用此参数变更分版原始分支，传入的分支版本名称将在 branches 以及 tags 进行寻找（优先在 tags 下寻找），如果没有找到，将抛出异常代码 [1000](#1000)

_① 根路径判定依据：当前路径下存在 tags、branches 目录_

### 1-2、Merge

### 1-3、Tag（封板功能）

## 2、打包产生目标文件

## 3、目标文件对环境配置的集成替换以及缓存问题处理

## 4、Jenkins 配置文件生成以及相关辅助文件的生成

## 异常代码定义

#### 1000

基础分支不存在\n1、如果您传递了base分支名，请确定base原始分支名称是否正确\n2、如果您未传递base，则表明当前项目不存在main分支以及tags分支，这可能是一个新项目，因此无法完成分支创建任务

#### 1001

目标分支已存在，拒绝执行分支创建操作

#### 1002

在远端路径上未匹配到项目根路径，提供的远端路径不存在符合规则的项目根路径（路径下存在 tags、branches），请检查远端路径是否正确！

#### 7000

未知错误
